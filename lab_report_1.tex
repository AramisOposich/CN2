%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% CN2 Labreport template
%
% License:
% CC BY-NC-SA 3.0 (http://creativecommons.org/licenses/by-nc-sa/3.0/)
%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\documentclass[parskip=full]{scrartcl}

\usepackage{siunitx}  % Provides the \SI{}{} command for typesetting SI units
\usepackage{graphicx} % Required for the inclusion of images
\usepackage{booktabs} % nicer tables
\usepackage[noabbrev]{cleveref} % automatic references
\usepackage{listings} % typeset code
\usepackage[backend=biber]{biblatex}
\addbibresource{referenzen.bib}

\crefname{lstlisting}{listing}{listings} % for referencing code
\Crefname{lstlisting}{Listing}{Listings} % for referencing code

\usepackage[headsepline]{scrlayer-scrpage} % header
\ohead{Group 06} % right part of header
\ihead{Assignment 1} % left part of header

\lstset{basicstyle=\ttfamily} % monospaced font in listing



%----------------------------------------------------------------------------------------
%	DOCUMENT INFORMATION
%----------------------------------------------------------------------------------------

\begin{document}
\begin{titlepage}
    \centering
    \vspace*{2cm}
    {\Huge \textbf{Communication Networks 2}}\\
    SS 2021\\
    \vspace*{1cm}
    {\Large Assignment 1}
    \\\vspace*{3cm}
    {\Large \textbf{Group 06}}\\
    \vspace*{1cm}
    {\large 
        \begin{tabular}{l c c}
            Name & Mat.Nummer \\ \hline
            Paul Kloker & 12034928 \\
            Juan Aramis Oposich & 11701238
        \end{tabular}
    }
    \\\vspace*{7cm}
    \today
\end{titlepage}

%----------------------------------------------------------------------------------------
%	SECTION 1
%----------------------------------------------------------------------------------------
\section{Task and Protocol Description}

The subject of the first task is to observe email clientâ€™s network traffic and to extract the username and password from the client.  Furthermore this assignment offers some reflections on the security aspects of protocols using plaintext on network traffic.

\subsection{Internet Message Access Protocol}
The IMAP protocol is used by email clients to retrieve email messages from a mail server over a TCP connection. The protocol has been defined in the RFC 3501. Usually an IMAP server typically listens on port number 143, like our first task did. The more secure way is to run IMAP over SSL/TLS, which is assigned the port number 993.

\subsubsection{Authentication}
As this report will show, the IMAP protocol contains an authentication message, which leaks the vulnerability. The user must authenticate himself before he can gain access to mail. This is done by logging in with his username and password. The password is transmitted in plain text at the IMAP protocol level. Mail servers can therefore forbid clients from transmitting the password if no encrypted session has been established beforehand.\\

Furthermore IMAP has an extension for \textbf{PLAIN Simple Authentication and Security Layer (SASL)}\cite{zeilenga2006plain} which was designed to have a wider interoperability with other systems. The main drawback is shown in the first assignment, capturing the username and password of the client.

%----------------------------------------------------------------------------------------
%	SECTION 2
%----------------------------------------------------------------------------------------
\section{Method(Procedure?)}
This section describes the different steps that are needed to recover the forgotten email password from the network traffic between the email client and the email server. 
\subsection{Traffic capture with WireShark}
First all incoming and outgoing traffic needs to be captured by using WireShark. To reduce the number of captured packets the capture filter "\verb|not port 22|" was used because this prevents the SSH traffic from being captured as well. To get the IMAP or POP authentication message Thunderbird was launched right after the capturing process was started, which was terminated again after about 20 seconds. Scrolling through the capture showed quickly that IMAP was used to check for new messages and not POP.
\subsection{Filter captured traffic}
In order to show only the required IMAP messages the display filter "\verb|imap|" was used. A screen shot of WireShark with this filter applied can be seen in \cref{fig:ws}. 

\begin{figure}[!ht]
	\centering % centering figure 
	\includegraphics[height=6cm]{images/loremipsum.png} % importing figure
	\caption{Captured IMAP traffic} 
	\label{fig:ws} % labeling to refer it inside the text
\end{figure} 

\subsection{Decode messages and find password}

Base64 Decoding:
\begin{verbatim}
base64 -di <<<AGNuXzA2QGV4MS5jbjJsYWIuY24udHV3aWVuLmFjLmF0AFBlZ3Vxb3Rhc2Uy
cn_06@ex1.cn2lab.cn.tuwien.ac.atPeguqotase2

base64 -di <<<AGNuXzA2QGV4MS5jbjJsYWIuY24udHV3aWVuLmFjLmF0AFBlZ3Vxb3Rhc2Uy | hexdump -c
0000000  \0   c   n   _   0   6   @   e   x   1   .   c   n   2   l   a
0000010   b   .   c   n   .   t   u   w   i   e   n   .   a   c   .   a
0000020   t  \0   P   e   g   u   q   o   t   a   s   e   2            
000002d
\end{verbatim}



As can be seen in \cref{tab:routing}, tables can also be useful.
%----------------------------------------------------------------------------------------
%	SECTION 3
%----------------------------------------------------------------------------------------
\section{Conclusion}

This shows how easy it is for attackers to retrieve passwords from plain text email traffic. Therefore, it is very important to make sure that all connections to the email server are TLS/SSL encrypted. With IMAP this can be done explicitly over port 143, by using STARTTLS, or implicitly over port 993 which enforces a encrypted connection.

\begin{figure}[ht]
 \centering % centering figure 
 \includegraphics[height=6cm]{images/loremipsum.png} % importing figure
 \caption{Don't forget to find a fitting caption for your graphics.} 
 \label{fig:lorem} % labeling to refer it inside the text
\end{figure} 

%----------------------------------------------------------------------------------------
%	SECTION X
%---------------------------------------------------------------------------------------

\begin{table}[hb]
	\centering
	\caption{Routing table for network A}
	\label{tab:routing}
	\begin{tabular}{lll}
		\toprule
		\textbf{router} & \textbf{destination} & \textbf{via}  \\ \midrule
		r1 & 10.1.2.0/24 & 10.3.2.1 \\
		r1 & 10.2.1.0/24 & 10.3.2.1 \\
		r1 & 10.5.3.0/24 & 10.0.2.1 \\
		\midrule
		r2 & 10.0.3.0/24 & 10.5.2.1 \\
		\midrule
		r3 & 10.3.0.0/24 & 10.3.4.1 \\
		\bottomrule
	\end{tabular}
\end{table}
With vspace, you can add vertical empty space for formatting purposes (which should only be used as a last resort):
\vspace*{1cm}

The following text is now shifted vertically for one centimeter

\begin{itemize}
	\item Please use the \textit{itemize} environment for better and clear representation of
	\item your results
\end{itemize}

\begin{enumerate}
	\item Also you can use the \textit{enumerate} environment for 
	\item representing the sub-example
\end{enumerate}

\printbibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\end{document}
